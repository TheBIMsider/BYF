<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <!-- Enhanced Mobile Support -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <link
      rel="apple-touch-icon"
      href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiBmaWxsPSIjMDA3YmZmIiByeD0iMjQiLz4KPHBhdGggZD0iTTk2IDQ4TDEyMCA3MkgxNDRWMTIwSDEyMEwxMDggMTA4TDk2IDEyMEw4NCA1NkwxMzIgNzhMOTYgNDhaIiBmaWxsPSJ3aGl0ZSIvPgo8Y2lyY2xlIGN4PSI5NiIgY3k9IjE0NCIgcj0iMTIiIGZpbGw9IndoaXRlIi8+Cjx0ZXh0IHg9Ijk2IiB5PSIxNzQiIGZpbGw9IndoaXRlIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkJZRjwvdGV4dD4KPC9zdmc+"
    />
    <title>BribeYourselfFit - JSONBin Cloud Version</title>
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#007bff" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="BribeYourselfFit" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="logo">BribeYourselfFit <span style="font-size: 0.7em; color: var(--accent-success);">Cloud</span></div>
        <div style="display: flex; gap: 1rem; align-items: center;">
          <button
            class="theme-toggle"
            id="themeToggle"
            aria-label="Toggle dark mode"
          >
            🌙 Dark Mode
          </button>
          <button
            class="btn btn-small"
            id="settingsBtn"
            style="display: none;"
            onclick="app.showSettings()"
          >
            ⚙️ Settings
          </button>
        </div>
      </div>
    </header>

    <div class="container">
      <!-- Setup Screen -->
      <div id="setupScreen" class="setup-form">
        <div class="setup-header">
          <h1 class="setup-title">Welcome to BribeYourselfFit Cloud!</h1>
          <p class="setup-subtitle">Let's set up your cloud-synced fitness goals</p>
        </div>

        <!-- JSONBin API Setup -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">🌐 Cloud Storage Setup</h2>
          </div>
          
          <div style="margin-bottom: 1.5rem; padding: 1rem; background-color: var(--bg-primary); border-radius: 8px; border: 2px solid var(--accent-warning);">
            <h4 style="color: var(--accent-warning); margin-bottom: 0.5rem;">📋 Setup Instructions:</h4>
            <ol style="margin-left: 1.5rem; color: var(--text-secondary);">
              <li>Visit <a href="https://jsonbin.io" target="_blank" style="color: var(--accent-primary);">jsonbin.io</a></li>
              <li>Create a free account (10,000 requests/month)</li>
              <li>Go to API Keys section</li>
              <li>Create a new API key with "Create, Read, Update" permissions</li>
              <li>Copy the API key and paste it below</li>
            </ol>
          </div>

          <form id="apiSetupForm">
            <div class="form-group">
              <label for="jsonbinApiKey" class="form-label">
                JSONBin.io API Key
                <span style="color: var(--text-secondary); font-size: 0.9rem;">(Required for cloud sync)</span>
              </label>
              <input
                type="password"
                id="jsonbinApiKey"
                class="form-input"
                placeholder="$2a$10$..."
                required
              />
              <small style="color: var(--text-secondary); font-size: 0.8rem;">
                🔒 Your API key is stored locally and never shared
              </small>
            </div>

            <div class="form-group">
              <label for="binName" class="form-label">
                Storage Name
                <span style="color: var(--text-secondary); font-size: 0.9rem;">(Give your data a friendly name)</span>
              </label>
              <input
                type="text"
                id="binName"
                class="form-input"
                placeholder="My Fitness Journey 2025"
                maxlength="50"
              />
              <small style="color: var(--text-secondary); font-size: 0.8rem;">
                Optional: Will default to "BYF-Data-[timestamp]" if empty
              </small>
            </div>

            <button
              type="submit"
              class="btn btn-primary"
              style="width: 100%; margin-top: 1rem"
            >
              🔗 Connect to Cloud Storage
            </button>
          </form>
        </div>

        <!-- User Profile Setup -->
        <div class="card" id="profileSetupCard" style="opacity: 0.5; pointer-events: none;">
          <div class="card-header">
            <h2 class="card-title">👤 Your Fitness Profile</h2>
            <span style="color: var(--text-secondary); font-size: 0.9rem;">Complete cloud setup first</span>
          </div>

          <form id="setupForm">
            <div class="form-group">
              <label for="startingWeight" class="form-label"
                >Current Weight (lbs)</label
              >
              <input
                type="number"
                id="startingWeight"
                class="form-input"
                required
                min="50"
                max="1000"
                step="0.1"
              />
            </div>

            <div class="form-group">
              <label for="goalWeight" class="form-label"
                >Goal Weight (lbs)</label
              >
              <input
                type="number"
                id="goalWeight"
                class="form-input"
                required
                min="50"
                max="1000"
                step="0.1"
              />
            </div>

            <div class="form-group">
              <label for="dailySteps" class="form-label"
                >Daily Steps Goal</label
              >
              <input
                type="number"
                id="dailySteps"
                class="form-input"
                required
                min="1000"
                max="50000"
                value="8000"
              />
            </div>

            <div class="form-group">
              <label for="dailyExercise" class="form-label"
                >Daily Exercise Minutes Goal</label
              >
              <input
                type="number"
                id="dailyExercise"
                class="form-input"
                required
                min="5"
                max="300"
                value="30"
              />
            </div>

            <div class="form-group">
              <label for="dailyWater" class="form-label"
                >Daily Water Goal (liters)</label
              >
              <input
                type="number"
                id="dailyWater"
                class="form-input"
                required
                min="0.5"
                max="10"
                step="0.1"
                value="2"
              />
            </div>

            <button
              type="submit"
              class="btn btn-success"
              style="width: 100%; margin-top: 1rem"
              disabled
            >
              🚀 Start My Cloud Fitness Journey
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
      <div class="modal-content" style="max-width: 600px;">
        <h2 class="modal-title">⚙️ Settings</h2>
        
        <div style="margin-bottom: 2rem;">
          <h3 style="margin-bottom: 1rem;">🌐 Cloud Storage</h3>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <span>Status:</span>
            <span id="cloudStatus" style="color: var(--accent-success);">✅ Connected</span>
          </div>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <span>Storage Name:</span>
            <span id="currentBinName">--</span>
          </div>
          <button class="btn btn-small btn-danger" onclick="app.resetApiKey()">
            🔄 Change API Key
          </button>
        </div>

        <div style="margin-bottom: 2rem;">
          <h3 style="margin-bottom: 1rem;">📊 Data Management</h3>
          <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
            <button class="btn btn-small" onclick="app.exportData()">
              📥 Export Data
            </button>
            <button class="btn btn-small btn-danger" onclick="app.resetAllData()">
              🗑️ Reset All Data
            </button>
          </div>
        </div>

        <button class="modal-btn" onclick="app.closeSettings()">Close</button>
      </div>
    </div>

    <!-- Main App Screen -->
    <div id="appScreen" class="hidden">
      <!-- Navigation Tabs -->
      <div class="tab-navigation">
        <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
        <button class="tab-btn" data-tab="charts">Progress</button>
        <button class="tab-btn" data-tab="rewards">Rewards</button>
      </div>

      <!-- Dashboard Tab -->
      <div id="dashboardTab" class="tab-content active">
        <div class="main-grid">
          <!-- Main Content -->
          <div class="content-main">
            <!-- Daily Logging -->
            <div class="card">
              <div class="card-header">
                <h2 class="card-title">Today's Log</h2>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                  <span id="currentDate"></span>
                  <span id="syncStatus" style="font-size: 0.8rem; color: var(--accent-success);">☁️</span>
                </div>
              </div>

              <form id="dailyLogForm">
                <div class="form-group">
                  <label for="todayWeight" class="form-label">
                    Weight (Weekly Requirement)
                    <span
                      id="weightStatus"
                      style="font-size: 0.9rem; color: var(--text-secondary)"
                    ></span>
                  </label>
                  <input
                    type="number"
                    id="todayWeight"
                    class="form-input"
                    min="50"
                    max="1000"
                    step="0.1"
                  />
                </div>

                <div class="form-group">
                  <label for="todaySteps" class="form-label">Steps</label>
                  <input
                    type="number"
                    id="todaySteps"
                    class="form-input"
                    min="0"
                    max="100000"
                  />
                </div>

                <div class="form-group">
                  <label for="todayExerciseMinutes" class="form-label"
                    >Exercise Minutes</label
                  >
                  <input
                    type="number"
                    id="todayExerciseMinutes"
                    class="form-input"
                    min="0"
                    max="1440"
                  />
                </div>

                <div class="form-group">
                  <label for="todayExerciseType" class="form-label"
                    >Exercise Type(s)</label
                  >
                  <div class="exercise-selector" id="exerciseSelector">
                    <div class="exercise-option">
                      <input
                        type="checkbox"
                        id="cardio"
                        value="cardio"
                        class="exercise-checkbox"
                      />
                      <label for="cardio" class="exercise-label">Cardio</label>
                    </div>
                    <div class="exercise-option">
                      <input
                        type="checkbox"
                        id="strength"
                        value="strength"
                        class="exercise-checkbox"
                      />
                      <label for="strength" class="exercise-label"
                        >Strength Training</label
                      >
                    </div>
                    <div class="exercise-option">
                      <input
                        type="checkbox"
                        id="yoga"
                        value="yoga"
                        class="exercise-checkbox"
                      />
                      <label for="yoga" class="exercise-label"
                        >Yoga/Stretching</label
                      >
                    </div>
                    <div class="exercise-option">
                      <input
                        type="checkbox"
                        id="sports"
                        value="sports"
                        class="exercise-checkbox"
                      />
                      <label for="sports" class="exercise-label">Sports</label>
                    </div>
                    <div class="exercise-option">
                      <input
                        type="checkbox"
                        id="walking"
                        value="walking"
                        class="exercise-checkbox"
                      />
                      <label for="walking" class="exercise-label"
                        >Walking</label
                      >
                    </div>
                    <div class="exercise-option">
                      <input
                        type="checkbox"
                        id="other"
                        value="other"
                        class="exercise-checkbox"
                      />
                      <label for="other" class="exercise-label">Other</label>
                    </div>
                  </div>
                </div>

                <div class="form-group">
                  <label for="todayWater" class="form-label"
                    >Water Intake (liters)</label
                  >
                  <input
                    type="number"
                    id="todayWater"
                    class="form-input"
                    min="0"
                    max="20"
                    step="0.1"
                  />
                </div>

                <button
                  type="submit"
                  class="btn btn-success"
                  style="width: 100%; margin-top: 1rem"
                >
                  💾 Save to Cloud
                </button>
              </form>
            </div>

            <!-- Food & Wellness Score -->
            <div class="card">
              <div class="card-header">
                <h2 class="card-title">Food & Wellness Score</h2>
                <span>Need 3+ points for daily streak</span>
              </div>

              <ul class="wellness-checklist" id="wellnessChecklist">
                <li class="wellness-item">
                  <input
                    type="checkbox"
                    class="wellness-checkbox"
                    data-wellness="sugary-drinks"
                  />
                  <div class="wellness-content">
                    <div class="wellness-title">Avoided Sugary Drinks</div>
                    <div class="wellness-description">
                      No soda, juice, sweetened coffee/tea, energy drinks.
                      Reduces empty calories and blood sugar spikes.
                    </div>
                  </div>
                </li>

                <li class="wellness-item">
                  <input
                    type="checkbox"
                    class="wellness-checkbox"
                    data-wellness="fruits-vegetables"
                  />
                  <div class="wellness-content">
                    <div class="wellness-title">
                      Ate 5+ Servings of Fruits & Vegetables
                    </div>
                    <div class="wellness-description">
                      Fresh, frozen, or cooked all count. Provides fiber,
                      vitamins, and phytonutrients.
                    </div>
                  </div>
                </li>

                <li class="wellness-item">
                  <input
                    type="checkbox"
                    class="wellness-checkbox"
                    data-wellness="portion-control"
                  />
                  <div class="wellness-content">
                    <div class="wellness-title">Practiced Portion Control</div>
                    <div class="wellness-description">
                      Used smaller plates, stopped when satisfied, followed
                      hand-size portion guides.
                    </div>
                  </div>
                </li>

                <li class="wellness-item">
                  <input
                    type="checkbox"
                    class="wellness-checkbox"
                    data-wellness="no-late-eating"
                  />
                  <div class="wellness-content">
                    <div class="wellness-title">Did Not Eat After 8 PM</div>
                    <div class="wellness-description">
                      No late-night snacking. Helps with digestion, sleep, and
                      curbing mindless eating.
                    </div>
                  </div>
                </li>

                <li class="wellness-item">
                  <input
                    type="checkbox"
                    class="wellness-checkbox"
                    data-wellness="sleep"
                  />
                  <div class="wellness-content">
                    <div class="wellness-title">Got 7+ Hours of Sleep</div>
                    <div class="wellness-description">
                      Quality rest for recovery. Impacts metabolism, hunger
                      hormones, and decision-making.
                    </div>
                  </div>
                </li>
              </ul>

              <div class="wellness-score">
                <span>Current Score:</span>
                <div class="score-indicator"></div>
                <div class="score-indicator"></div>
                <div class="score-indicator"></div>
                <div class="score-indicator"></div>
                <div class="score-indicator"></div>
                <span id="wellnessScoreText">0/5</span>
              </div>
            </div>
          </div>

          <!-- Sidebar -->
          <div class="sidebar">
            <!-- Current Streak -->
            <div class="streak-counter">
              <span class="streak-number" id="currentStreak">0</span>
              <div class="streak-label">Day Streak</div>
            </div>

            <!-- Streak Breakdown -->
            <div class="streak-grid">
              <div class="streak-item" id="stepsStreak">
                <div class="streak-value">0</div>
                <div class="streak-type">Steps</div>
              </div>
              <div class="streak-item" id="exerciseStreak">
                <div class="streak-value">0</div>
                <div class="streak-type">Exercise</div>
              </div>
              <div class="streak-item" id="waterStreak">
                <div class="streak-value">0</div>
                <div class="streak-type">Water</div>
              </div>
              <div class="streak-item" id="wellnessStreak">
                <div class="streak-value">0</div>
                <div class="streak-type">Wellness</div>
              </div>
            </div>

            <!-- Quick Stats -->
            <div style="margin-top: 2rem">
              <h3 style="margin-bottom: 1rem; color: var(--text-primary)">
                Quick Stats
              </h3>
              <div style="display: flex; flex-direction: column; gap: 0.5rem">
                <div style="display: flex; justify-content: space-between">
                  <span>Current Weight:</span>
                  <span id="currentWeightDisplay">--</span>
                </div>
                <div style="display: flex; justify-content: space-between">
                  <span>Goal Weight:</span>
                  <span id="goalWeightDisplay">--</span>
                </div>
                <div style="display: flex; justify-content: space-between">
                  <span>To Go:</span>
                  <span id="weightToGoDisplay">--</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Progress Charts Tab -->
      <div id="chartsTab" class="tab-content hidden">
        <div class="charts-container">
          <!-- Chart Controls -->
          <div class="chart-controls">
            <button class="chart-btn active" data-period="7">7 Days</button>
            <button class="chart-btn" data-period="30">30 Days</button>
            <button class="chart-btn" data-period="all">All Time</button>
          </div>

          <!-- Weight Progress Chart -->
          <div class="card chart-card">
            <div class="card-header">
              <h2 class="card-title">Weight Progress</h2>
              <span id="weightTrend"></span>
            </div>
            <div class="chart-container">
              <canvas id="weightChart" width="800" height="400"></canvas>
            </div>
          </div>

          <!-- Activity Summary Chart -->
          <div class="card chart-card">
            <div class="card-header">
              <h2 class="card-title">Daily Activity Summary</h2>
              <span id="activityPeriod">Last 7 Days</span>
            </div>
            <div class="chart-container">
              <canvas id="activityChart" width="800" height="400"></canvas>
            </div>
          </div>

          <!-- Streak Calendar -->
          <div class="card chart-card">
            <div class="card-header">
              <h2 class="card-title">Streak Calendar</h2>
              <div class="calendar-controls">
                <button id="prevMonth">‹</button>
                <span id="currentMonth"></span>
                <button id="nextMonth">›</button>
              </div>
            </div>
            <div class="calendar-container" id="streakCalendar"></div>
          </div>
        </div>
      </div>

      <!-- Rewards Tab -->
      <div id="rewardsTab" class="tab-content hidden">
        <div class="rewards-container">
          <!-- Add Custom Reward -->
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Add Custom Reward</h2>
            </div>
            <form id="rewardForm">
              <div class="form-group">
                <label for="rewardType" class="form-label">Reward Type</label>
                <select id="rewardType" class="form-select" required>
                  <option value="">Select reward type</option>
                  <option value="streak">Streak Milestone</option>
                  <option value="weight">Weight Loss</option>
                  <option value="combo">Combined (Streak + Weight)</option>
                </select>
              </div>

              <div class="reward-criteria hidden" id="streakCriteria">
                <div class="form-group">
                  <label for="streakDays" class="form-label">Streak Days</label>
                  <input
                    type="number"
                    id="streakDays"
                    class="form-input"
                    min="1"
                    max="365"
                  />
                </div>
              </div>

              <div class="reward-criteria hidden" id="weightCriteria">
                <div class="form-group">
                  <label for="weightLoss" class="form-label"
                    >Weight Loss (lbs)</label
                  >
                  <input
                    type="number"
                    id="weightLoss"
                    class="form-input"
                    min="1"
                    step="0.1"
                  />
                </div>
              </div>

              <div class="reward-criteria hidden" id="comboCriteria">
                <div class="form-group">
                  <label for="comboStreak" class="form-label"
                    >Streak Days</label
                  >
                  <input
                    type="number"
                    id="comboStreak"
                    class="form-input"
                    min="1"
                    max="365"
                  />
                </div>
                <div class="form-group">
                  <label for="comboWeight" class="form-label"
                    >Weight Loss (lbs)</label
                  >
                  <input
                    type="number"
                    id="comboWeight"
                    class="form-input"
                    min="1"
                    step="0.1"
                  />
                </div>
              </div>

              <div class="form-group">
                <label for="rewardDescription" class="form-label"
                  >Reward Description</label
                >
                <input
                  type="text"
                  id="rewardDescription"
                  class="form-input"
                  placeholder="e.g., Spa day, New workout clothes, Cheat meal"
                  required
                />
              </div>

              <button type="submit" class="btn btn-primary">Add Reward</button>
            </form>
          </div>

          <!-- Default Milestones -->
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Default Milestones</h2>
              <span>Customize your rewards for these milestones</span>
            </div>
            <div class="milestone-grid" id="defaultMilestones"></div>
          </div>

          <!-- Custom Rewards -->
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Your Custom Rewards</h2>
            </div>
            <div class="rewards-list" id="customRewardsList"></div>
          </div>

          <!-- Achievement History -->
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Achievement History</h2>
            </div>
            <div class="achievements-list" id="achievementHistory"></div>
          </div>
        </div>
      </div>
    </div>

    <script src="script.js"></script>
  </body>
</html>
